# =============================================================================
# Pose Transfer Configuration v6 (Final Integration)
# =============================================================================

# [0] 입력 모드 설정
# --------------------------------------------------------
# CLI 인자(--source, --reference)가 없을 때 이 설정을 사용합니다.
# internal: 프로젝트 내부 inputs 폴더의 파일을 사용 (테스트용)
# external: 절대 경로로 지정된 외부 파일을 사용 (실전/연동용)
input_mode:
  type: "internal"  # 'internal' or 'external'

  # [Type: internal] 설정
  internal:
    root_dir: "inputs"
    source_name: "source.jpg"
    reference_name: "reference.jpg"

  # [Type: external] 설정 (type을 external로 바꾸면 이 경로를 읽음)
  external:
    source_path: "/var/data/users/user_123.jpg"
    reference_path: "/var/data/poses/pose_dance.jpg"


# [1] 모델 설정
model:
  backend: "onnxruntime"  # 'onnxruntime' or 'openvino'
  device: "cuda"          # 'cuda' or 'cpu'
  mode: "performance"     # 'performance', 'lightweight', or 'balanced'
  to_openpose: false      # COCO-WholeBody 포맷 사용

# [2] 다중 인물 필터링
person_filter:
  enabled: true
  area_weight: 0.6        # 면적 가중치
  center_weight: 0.4      # 중심 거리 가중치
  min_keypoints: 5        # 최소 키포인트 수
  confidence_threshold: 0.3

# [3] 손 정밀화 (해상도 업스케일링)
hand_refinement:
  enabled: true
  min_hand_size: 48       # 이보다 작으면 업스케일 시도
  max_scale_factor: 4.0   # 최대 확대 배율

# [4] 포즈 전이 핵심 로직
transfer:
  normalization_base: "shoulder_width"
  confidence_threshold: 0.3
  
  # 하반신(Ghost Legs) 방지 설정 1: 점수 미달 시 제거
  lower_body_confidence_threshold: 0.5
  
  # 하반신 방지 설정 2: 이미지 바닥(Edge) 근처 좌표 무효화
  # 0.05 = 이미지 하단 5% 영역에 무릎이 있으면 가짜로 판단
  lower_body_margin_ratio: 0.05
  
  # [NEW] 스마트 클리핑: 화면 밖 허용 범위
  # 0.15 = 이미지 크기의 15% 정도는 벗어나도 그림 (그 이상은 자름)
  visibility_margin: 0.15

# [5] 폴백 전략 (누락된 부위 추정)
fallback:
  symmetric_mirror: true          # 대칭 부위(왼팔<->오른팔) 복사 허용
  hierarchical_estimation: true   # 부모 노드 기반 추정 허용
  fallback_confidence_decay: 0.5  # 추정된 키포인트의 신뢰도 감소율

# [6] 렌더링 스타일 (상대적 크기 적용됨)
# 값은 이미지 긴 변이 1000px일 때의 기준 픽셀입니다.
rendering:
  line_thickness: 10          # Body 선 두께
  face_line_thickness: 5      # Face 선 두께
  hand_line_thickness: 5      # Hand 선 두께
  point_radius: 6             # 관절 점 크기
  background_color: [0, 0, 0] # 배경색 (BGR)
  kpt_threshold: 0.3          # 이 점수 이상만 렌더링

# [7] 출력 설정
output:
  save_json: true
  save_skeleton_image: true
  save_debug_image: false

# [8] 시스템 설정 (파일 관리)
system:
  # 작업 완료 후 입력 파일 처리 방식
  # true: archive 폴더로 이동 (보관)
  # false: 삭제 (휘발성, 스토리지 절약)
  enable_archiving: false

# [9] 얼굴 부위별 렌더링 제어
face_rendering:
  enabled: true  # false면 얼굴 전체 안 그림
  
  parts:
    # 턱 라인 (얼굴 윤곽) - 끄는 것이 자연스러움
    jawline:
      enabled: false
      color: [255, 255, 255]
    
    # 눈썹
    left_eyebrow:
      enabled: true
      color: [255, 255, 255]
    right_eyebrow:
      enabled: true
      color: [255, 255, 255]
    
    # 코
    nose:
      enabled: true
      color: [255, 255, 255]
    
    # 눈
    left_eye:
      enabled: true
      color: [255, 255, 255]
    right_eye:
      enabled: true
      color: [255, 255, 255]
    
    # 입 (바깥 라인)
    mouth_outer:
      enabled: true
      color: [255, 255, 255]
    
    # 입 (안쪽 라인)
    mouth_inner:
      enabled: true
      color: [255, 255, 255]
