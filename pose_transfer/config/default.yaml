# =============================================================================
# Pose Transfer Configuration v11 (Final Integration)
# =============================================================================

# [0] 입력 모드 설정
input_mode:
  type: "internal"  # 'internal' or 'external'

  internal:
    root_dir: "inputs"
    src_dir: "src"      
    ref_dir: "ref"      

  external:
    source_path: "/var/data/users/user_123.jpg"
    reference_path: "/var/data/poses/pose_dance.jpg"

# [1] 모델 설정
model:
  backend: "onnxruntime"
  device: "cuda"
  mode: "performance"
  to_openpose: false

# [2] 다중 인물 필터링
person_filter:
  enabled: true
  area_weight: 0.6
  center_weight: 0.4
  min_keypoints: 5
  confidence_threshold: 0.3

# [3] 손 정밀화
hand_refinement:
  enabled: true
  min_hand_size: 48
  max_scale_factor: 4.0

# [4] 포즈 전이 & Ghost Legs 설정
transfer:
  normalization_base: "shoulder_width"
  confidence_threshold: 0.3
  
  # Ghost Legs 클리핑 (입력 단계 검증용)
  ghost_legs_clipping_enabled: true
  
  # [중요] 하반신 신뢰도 임계값 (낮춰서 데이터 보존)
  lower_body_confidence_threshold: 0.5
  
  # [중요] 이미지 바닥 마진 (0.025 = 2.5% 여유)
  lower_body_margin_ratio: 0.025
  
  # [중요] 화면 밖 허용 범위 (0.5 = 50%까지 벗어나도 데이터 유지 -> 캔버스 확장으로 해결)
  visibility_margin: 0.5

# [5] 폴백 전략
fallback:
  symmetric_mirror: true
  hierarchical_estimation: true
  fallback_confidence_decay: 0.5

# [6] 렌더링 스타일 (동적 스케일링 적용)
rendering:
  line_thickness: 4
  face_line_thickness: 4
  hand_line_thickness: 4
  point_radius: 2
  background_color: [0, 0, 0]
  kpt_threshold: 0.1          # 낮은 점수도 일단 그림

# [7] 출력 설정
output:
  save_json: true
  save_skeleton_image: true
  save_debug_image: true
  
  # 키포인트 기반 자동 캔버스 조정
  auto_crop_enabled: true
  
  # [NEW] 캔버스 여백 비율 (10% 여유 -> 발 잘림 방지)
  canvas_padding_ratio: 0.1
  
  # 고정 픽셀 패딩
  crop_padding_px: 0
  
  # 머리 위 추가 패딩
  head_padding_ratio: 0.5

# [8] 시스템 설정
system:
  retain_inputs: true    # 테스트용 (파일 유지)
  enable_archiving: false

# [NEW] 디버그 Bbox 시각화
debug:
  bbox_visualization: true
  visualize_keypoint_bbox: true
  visualize_yolo_bbox: true
  visualize_hybrid_bbox: true

# [9] 얼굴 부위별 렌더링 제어
face_rendering:
  enabled: true
  parts:
    jawline:
      enabled: true
      color: [255, 255, 255]
    left_eyebrow:
      enabled: true
      color: [255, 255, 255]
    right_eyebrow:
      enabled: true
      color: [255, 255, 255]
    nose:
      enabled: true
      color: [255, 255, 255]
    left_eye:
      enabled: true
      color: [255, 255, 255]
    right_eye:
      enabled: true
      color: [255, 255, 255]
    mouth_outer:
      enabled: true
      color: [255, 255, 255]
    mouth_inner:
      enabled: true
      color: [255, 255, 255]